(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["permission-role"],{"2e1f":function(e,t,n){},"805e":function(e,t,n){"use strict";n.r(t);n("b0c0"),n("a4d3"),n("e01a");var r=n("8bbf"),o={class:"app-container"},c={style:{"text-align":"right"}};function a(e,t,n,a,i,l){var u=Object(r["resolveComponent"])("el-button"),s=Object(r["resolveComponent"])("el-table-column"),d=Object(r["resolveComponent"])("el-table"),b=Object(r["resolveComponent"])("el-input"),f=Object(r["resolveComponent"])("el-form-item"),p=Object(r["resolveComponent"])("el-tree"),h=Object(r["resolveComponent"])("el-form"),O=Object(r["resolveComponent"])("el-dialog");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",o,[Object(r["createVNode"])(u,{type:"primary",onClick:e.handleCreateRole},{default:Object(r["withCtx"])((function(){return[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.t("permission.createRole")),1)]})),_:1},8,["onClick"]),Object(r["createVNode"])(d,{data:e.rolesList,style:{width:"100%","margin-top":"30px"},border:""},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(s,{align:"center",label:"Role Key",width:"220"},{default:Object(r["withCtx"])((function(e){var t=e.row;return[Object(r["createTextVNode"])(Object(r["toDisplayString"])(t.key),1)]})),_:1}),Object(r["createVNode"])(s,{align:"center",label:"Role Name",width:"220"},{default:Object(r["withCtx"])((function(e){var t=e.row;return[Object(r["createTextVNode"])(Object(r["toDisplayString"])(t.name),1)]})),_:1}),Object(r["createVNode"])(s,{align:"header-center",label:"Description"},{default:Object(r["withCtx"])((function(e){var t=e.row;return[Object(r["createTextVNode"])(Object(r["toDisplayString"])(t.description),1)]})),_:1}),Object(r["createVNode"])(s,{align:"center",label:"Operations"},{default:Object(r["withCtx"])((function(t){return[Object(r["createVNode"])(u,{type:"primary",size:"small",onClick:function(n){return e.handleEdit(t)}},{default:Object(r["withCtx"])((function(){return[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.t("permission.editPermission")),1)]})),_:2},1032,["onClick"]),Object(r["createVNode"])(u,{type:"danger",size:"small",onClick:function(n){return e.handleDelete(t)}},{default:Object(r["withCtx"])((function(){return[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.t("permission.delete")),1)]})),_:2},1032,["onClick"])]})),_:1})]})),_:1},8,["data"]),Object(r["createVNode"])(O,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[3]||(t[3]=function(t){return e.dialogVisible=t}),title:"edit"===e.dialogType?"Edit Role":"New Role"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(h,{model:e.role,"label-width":"80px","label-position":"left"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(f,{label:"Name"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(b,{modelValue:e.role.name,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.role.name=t}),placeholder:"Role Name"},null,8,["modelValue"])]})),_:1}),Object(r["createVNode"])(f,{label:"Desc"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(b,{modelValue:e.role.description,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.role.description=t}),autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"Role Description"},null,8,["modelValue"])]})),_:1}),Object(r["createVNode"])(f,{label:"Menus"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(p,{ref:"treeRef","check-strictly":e.checkStrictly,data:e.routesTreeData,props:e.defaultProps,"show-checkbox":"","node-key":"path",class:"permission-tree"},null,8,["check-strictly","data","props"])]})),_:1})]})),_:1},8,["model"]),Object(r["createElementVNode"])("div",c,[Object(r["createVNode"])(u,{type:"danger",onClick:t[2]||(t[2]=function(t){return e.dialogVisible=!1})},{default:Object(r["withCtx"])((function(){return[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.t("permission.cancel")),1)]})),_:1}),Object(r["createVNode"])(u,{type:"primary",onClick:e.confirmRole},{default:Object(r["withCtx"])((function(){return[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.t("permission.confirm")),1)]})),_:1},8,["onClick"])])]})),_:1},8,["modelValue","title"])])}var i=n("1da1"),l=n("b85c"),u=n("5530"),s=(n("96cf"),n("4de4"),n("d3b7"),n("25f0"),n("caad"),n("2532"),n("d81d"),n("a434"),n("99af"),n("59b9")),d=n("7b62"),b=function(){return Object(s["a"])().request("roles/getRoutes",d["b"].GET,void 0,d["a"].form)},f=function(){return Object(s["a"])().request("roles/getRoles",d["b"].GET,void 0,d["a"].form)},p=function(e){return Object(s["a"])().request("roles/deleteRole",d["b"].DELETE,{id:e},d["a"].form)},h=function(e,t){return Object(s["a"])().request("roles/updateRole/".concat(e),d["b"].POST,t,d["a"].form)},O=function(e){return Object(s["a"])().request("roles/createRole",d["b"].PUT,e,d["a"].form)},m=n("df7c"),j=n("d899"),v=n("2909"),g=(n("4160"),n("159b"),function(){var e=function e(t){var n=[];return t.forEach((function(t){if(n.push(t),t.children){var r=e(t.children);r.length>0&&(n=[].concat(Object(v["a"])(n),Object(v["a"])(r)))}})),n};return{flattenRoutes:e}}),y=n("60bb"),w={key:0,name:"",description:"",routes:[]},x=Object(r["defineComponent"])({setup:function(){var e=Object(r["getCurrentInstance"])(),t=e.ctx,n=Object(r["ref"])(null),o=Object(j["useI18n"])(),c=o.t,a=g(),s=a.flattenRoutes,d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=null,r=e.filter((function(e){return!e.meta||!e.meta.hidden}));return 1===r.length?(n=r[0],n.path=Object(m["resolve"])(t.path,n.path),n):0===r.length&&(n=Object(u["a"])(Object(u["a"])({},t),{},{path:""}),n)},v=function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",o=[],c=Object(l["a"])(t);try{for(c.s();!(n=c.n()).done;){var a=n.value;if(!a.meta||!a.meta.hidden){var i=d(a.children,a);!a.children||!i||a.meta&&a.meta.alwaysShow||(a=i);var u={path:Object(m["resolve"])(r,a.path),meta:{title:a.meta&&a.meta.title}};a.children&&(u.children=e(a.children,u.path)),o.push(u)}}}catch(s){c.e(s)}finally{c.f()}return o},x=function e(t){var n,r=[],o=Object(l["a"])(t);try{for(o.s();!(n=o.n()).done;){var a=n.value,i={children:[],title:"",path:""};i.title=a.meta?c("route.".concat(a.meta.title)).toString():"",i.path=a.path,a.children&&(i.children=e(a.children)),r.push(i)}}catch(u){o.e(u)}finally{o.f()}return r},k=function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",o=arguments.length>2?arguments[2]:void 0,c=[],a=Object(l["a"])(t);try{for(a.s();!(n=a.n()).done;){var i=n.value,u=Object(m["resolve"])(r,i.path);i.children&&(i.children=e(i.children,u,o)),(o.includes(u)||i.children&&i.children.length>=1)&&c.push(i)}}catch(s){a.e(s)}finally{a.f()}return c},V=Object(r["reactive"])({role:Object.assign({},w),reshapedRoutes:[],serviceRoutes:[],rolesList:[],dialogVisible:!1,dialogType:"new",checkStrictly:!1,defaultProps:{children:"children",label:"title"},handleCreateRole:function(){V.role=Object.assign({},w),n.value&&n.value.setCheckedKeys([]),V.dialogType="new",V.dialogVisible=!0},handleEdit:function(e){V.dialogType="edit",V.dialogVisible=!0,V.checkStrictly=!0,V.role=Object(y["cloneDeep"])(e.row),Object(r["nextTick"])((function(){var e=s(v(V.role.routes)),t=x(e),r=t.map((function(e){return e.path})),o=n.value;o.setCheckedKeys(r),V.checkStrictly=!1}))},handleDelete:function(e){var n=e.$index,r=e.row;t.$confirm("Confirm to remove the role?","Warning",{confirmButtonText:"Confirm",cancelButtonText:"Cancel",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:p(r.key).then((function(e){V.rolesList.splice(n,1),t.$message({type:"success",message:null===e||void 0===e?void 0:e.data})}));case 1:case"end":return e.stop()}}),e)}))))}}),C=function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var r,o,c,a,l,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r="edit"===V.dialogType,o=n.value.getCheckedKeys(),V.role.routes=k(Object(y["cloneDeep"])(V.serviceRoutes),"/",o),!r){e.next=8;break}return e.next=6,h(V.role.key,{role:V.role}).then(Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=0;case 1:if(!(t<V.rolesList.length)){e.next=8;break}if(V.rolesList[t].key!==V.role.key){e.next=5;break}return V.rolesList.splice(t,1,Object.assign({},V.role)),e.abrupt("break",8);case 5:t++,e.next=1;break;case 8:case"end":return e.stop()}}),e)}))));case 6:e.next=10;break;case 8:return e.next=10,O({role:V.role}).then(function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:V.role.key=null===t||void 0===t?void 0:t.data.key,V.rolesList.push(V.role);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 10:c=V.role,a=c.description,l=c.key,u=c.name,V.dialogVisible=!1,t.$notify({title:"Success",dangerouslyUseHTMLString:!0,message:"\n          <div>Role Key: ".concat(l,"</div>\n          <div>Role Name: ").concat(u,"</div>\n          <div>Description: ").concat(a,"</div>\n        "),type:"success"});case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),R=function(){b().then((function(e){V.serviceRoutes=null===e||void 0===e?void 0:e.data.routes,V.reshapedRoutes=v(null===e||void 0===e?void 0:e.data.routes)}))},N=function(){f().then((function(e){V.rolesList=null===e||void 0===e?void 0:e.data.items}))};Object(r["onBeforeMount"])((function(){R(),N()}));var T=Object(r["computed"])((function(){return x(V.reshapedRoutes)}));return Object(u["a"])(Object(u["a"])({t:c,confirmRole:C},Object(r["toRefs"])(V)),{},{treeRef:n,routesTreeData:T})}}),k=(n("93c0"),n("d959")),V=n.n(k);const C=V()(x,[["render",a],["__scopeId","data-v-36d2f4a6"]]);t["default"]=C},"93c0":function(e,t,n){"use strict";n("2e1f")},d81d:function(e,t,n){"use strict";var r=n("23e7"),o=n("b727").map,c=n("1dde"),a=c("map");r({target:"Array",proto:!0,forced:!a},{map:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})}}]);